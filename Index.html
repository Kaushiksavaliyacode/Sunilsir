<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#069494">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Material Calc">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Material Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Poppins',sans-serif;background:#f8f9fa;min-height:100vh;padding:10px}
        .container{max-width:100%;margin:auto}
        .table-wrapper{background:#fff;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,.08);padding:12px;overflow:hidden}
        table{width:100%;border-collapse:collapse;font-size:13px}
        th{background:#069494;color:#fff;padding:8px 6px;font-size:12px;text-align:center}
        td{padding:8px 6px;border-bottom:1px solid #e9ecef}
        .label{font-weight:600;color:#1a1a1a;width:28%;font-size:13px}
        .fixed-cell,.input-cell{width:36%;text-align:center}
        .fixed-cell{background:#e3f5f5;color:#069494;font-weight:700;font-size:16px;cursor:pointer;position:relative}
        .fixed-cell:hover{opacity:0.9}
        .fixed-cell.editing input{width:100%;padding:4px;font-size:14px;border:2px solid #069494;border-radius:4px;background:#fff}
        .excel-input{width:100%;padding:10px;font-size:14px;border:1px solid #ccc;border-radius:6px;background:#fafbfc;text-align:center}
        .excel-input:focus{outline:none;border-color:#069494;background:#fff;box-shadow:0 0 0 3px rgba(6,148,148,.1)}
        .excel-input:disabled{background:#e3f5f5;color:#069494;font-weight:700;border-color:#069494;font-size:15px}
        .unit{font-size:10px;color:#069494;margin-left:2px}
        @media(max-width:480px){
            body{padding:6px}
            .table-wrapper{padding:8px}
            th{font-size:11px;padding:6px 4px}
            td{padding:6px 4px}
            .label{font-size:12px}
            .fixed-cell{font-size:15px}
            .excel-input{font-size:13px;padding:8px}
            .excel-input:disabled{font-size:14px}
        }
    </style>
</head>
<body>
<div class="container">
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Parameter</th>
                    <th>Current</th>
                    <th>Set</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="label">Sizer</td>
                    <td class="fixed-cell" id="currentSizer" data-default="710">710<span class="unit">mm</span></td>
                    <td class="input-cell"><input type="number" class="excel-input" step="0.01" placeholder="Enter" id="setSizer"></td>
                </tr>
                <tr>
                    <td class="label">Micron</td>
                    <td class="fixed-cell" id="currentMicron" data-default="35">35<span class="unit">Âµm</span></td>
                    <td class="input-cell"><input type="number" class="excel-input" step="0.01" placeholder="Enter" id="setMicron"></td>
                </tr>
                <tr>
                    <td class="label">RPM</td>
                    <td class="fixed-cell" id="currentRPM" data-default="800">800<span class="unit">rpm</span></td>
                    <td class="input-cell"><input type="number" class="excel-input" step="0.01" placeholder="Enter" id="setRPM"></td>
                </tr>
                <tr>
                    <td class="label">LS 3</td>
                    <td class="fixed-cell" id="currentLS3" data-default="1080">1080</td>
                    <td class="input-cell"><input type="text" class="excel-input" placeholder="Auto" id="setLS3" disabled></td>
                </tr>
                <tr>
                    <td class="label">1 MTR Weight</td>
                    <td class="fixed-cell" id="currentWeight" data-default="0">-</td>
                    <td class="input-cell"><input type="text" class="excel-input" placeholder="Auto" id="setWeight" disabled></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
/* ---------- Global Current Values ---------- */
let CURRENT_SIZER = 710;
let CURRENT_MICRON = 35;
let CURRENT_RPM = 800;
let CURRENT_LS3 = 1080;
let useCustomLS3 = false;  // Track if user changed Current LS3

/* ---------- Long Press 5s to Edit Current Values ---------- */
const LONG_PRESS = 5000;
let timer, active = null;

function startPress(cell){
    if(cell.classList.contains('editing')) return;
    timer = setTimeout(() => makeEditable(cell), LONG_PRESS);
}
function cancelPress(){ clearTimeout(timer); }

function makeEditable(cell){
    const txt = cell.textContent.replace(/[^\d.-]/g,'').trim();
    const input = document.createElement('input');
    input.type='number'; input.step='0.01'; input.value = txt==='-'?'':txt;
    cell.innerHTML=''; cell.appendChild(input); cell.classList.add('editing');
    input.focus(); active = cell;

    const finish = ()=>{
        let v = parseFloat(input.value);
        if(isNaN(v)||v<0) v = cell.dataset.default||0;
        const unit = cell.querySelector('.unit');
        cell.textContent = v===0?'-':v;
        if(unit) cell.appendChild(unit);
        cell.classList.remove('editing');
        updateCurrent(cell.id, v);
        if(cell.id === 'currentLS3') useCustomLS3 = true;
        updateAll();
        active = null;
    };
    input.addEventListener('blur',finish);
    input.addEventListener('keydown',e=>{if(e.key==='Enter')finish();});
}

function updateCurrent(id,val){
    if(id==='currentSizer') CURRENT_SIZER=val;
    else if(id==='currentMicron') CURRENT_MICRON=val;
    else if(id==='currentRPM') CURRENT_RPM=val;
    else if(id==='currentLS3') CURRENT_LS3=val;
}

/* Attach long-press */
document.querySelectorAll('.fixed-cell').forEach(c=>{
    c.addEventListener('mousedown',e=>{e.preventDefault();startPress(c);});
    c.addEventListener('mouseup',cancelPress);
    c.addEventListener('mouseleave',cancelPress);
    c.addEventListener('touchstart',e=>{e.preventDefault();startPress(c);});
    c.addEventListener('touchend',cancelPress);
    c.addEventListener('touchcancel',cancelPress);
});

/* ---------- Main Calculation Logic ---------- */
function updateAll(){
    const setSizer = parseFloat(document.getElementById('setSizer').value) || 0;
    const setMicron = parseFloat(document.getElementById('setMicron').value) || 0;
    const setRPM = parseFloat(document.getElementById('setRPM').value) || 0;

    const setLS3 = document.getElementById('setLS3');
    const setWeight = document.getElementById('setWeight');

    if(setSizer <= 0 || setMicron <= 0 || CURRENT_RPM <= 0){
        setLS3.value = ''; 
        setWeight.value = '';
        document.getElementById('currentWeight').textContent = '-';
        return;
    }

    // 1 MTR Weight
    const weight = setSizer * 0.00280 * 1 * setMicron;
    setWeight.value = weight.toFixed(4);
    document.getElementById('currentWeight').textContent = weight.toFixed(4);

    // Step 1: Calculate base LS
    const baseLS = 21470400000 / setSizer / setMicron / CURRENT_RPM;

    // Step 2: Final LS3
    let finalLS3;
    if (useCustomLS3 && CURRENT_LS3 > 0) {
        finalLS3 = (CURRENT_LS3 / CURRENT_RPM) * setRPM;
    } else {
        finalLS3 = baseLS * (setRPM / CURRENT_RPM);
    }

    setLS3.value = finalLS3.toFixed(2);
}

/* ---------- Input Listeners (Set Column) ---------- */
document.addEventListener('DOMContentLoaded', () => {
    ['setSizer','setMicron','setRPM'].forEach(id => {
        document.getElementById(id).addEventListener('input', () => {
            useCustomLS3 = false; // Reset when Set values change
            updateAll();
        });
    });
});
</script>
</body>
</html>
